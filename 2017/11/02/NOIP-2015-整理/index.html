<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>NOIP 2015 整理 | ZJYelizaveta&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Day 1神奇的幻方描述幻方是一种很神奇的 $N \times N$ 矩阵：它由数字 $1,2,3, \cdots , N \times N$ 构成，且每行、每列及两条对角线上的数字之和都相同。">
<meta name="keywords" content="动态规划,搜索,模拟,dfs,二分,倍增,差分,LCA,拓扑排序,强连通分量,树上前缀和">
<meta property="og:type" content="article">
<meta property="og:title" content="NOIP 2015 整理">
<meta property="og:url" content="http://yoursite.com/2017/11/02/NOIP-2015-整理/index.html">
<meta property="og:site_name" content="ZJYelizaveta&#39;s Blog">
<meta property="og:description" content="Day 1神奇的幻方描述幻方是一种很神奇的 $N \times N$ 矩阵：它由数字 $1,2,3, \cdots , N \times N$ 构成，且每行、每列及两条对角线上的数字之和都相同。">
<meta property="og:image" content="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015.png">
<meta property="og:image" content="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015%E2%80%982.png">
<meta property="og:image" content="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015%27s.png">
<meta property="og:image" content="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015%275.png">
<meta property="og:updated_time" content="2017-11-02T08:15:17.169Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NOIP 2015 整理">
<meta name="twitter:description" content="Day 1神奇的幻方描述幻方是一种很神奇的 $N \times N$ 矩阵：它由数字 $1,2,3, \cdots , N \times N$ 构成，且每行、每列及两条对角线上的数字之和都相同。">
<meta name="twitter:image" content="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015.png">
    

    
        <link rel="alternate" href="/" title="ZJYelizaveta&#39;s Blog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">ZJYelizaveta&#39;s Blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
                    <a class="main-nav-link" href="/Links">Links</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                    <td><a class="main-nav-link" href="/Links">Links</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">ZJYelizaveta</h2>
            <h3 id="title">有幸在那一天，遇到你，最了不起的你。</h3>
            <span id="location"><i class="fa fa-map-marker"></i>Wuhan, China</span>
            <a id="follow" target="_blank" href="">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                81
                <span>posts</span>
            </div>
            <div class="article-info-block">
                108
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/ZJYelizaveta" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-NOIP-2015-整理" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            NOIP 2015 整理
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/11/02/NOIP-2015-整理/">
            <time datetime="2017-11-02T08:05:35.000Z" itemprop="datePublished">2017-11-02</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/LCA/">LCA</a>, <a class="tag-link" href="/tags/dfs/">dfs</a>, <a class="tag-link" href="/tags/二分/">二分</a>, <a class="tag-link" href="/tags/倍增/">倍增</a>, <a class="tag-link" href="/tags/动态规划/">动态规划</a>, <a class="tag-link" href="/tags/差分/">差分</a>, <a class="tag-link" href="/tags/强连通分量/">强连通分量</a>, <a class="tag-link" href="/tags/拓扑排序/">拓扑排序</a>, <a class="tag-link" href="/tags/搜索/">搜索</a>, <a class="tag-link" href="/tags/树上前缀和/">树上前缀和</a>, <a class="tag-link" href="/tags/模拟/">模拟</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h1 id="Day-1"><a href="#Day-1" class="headerlink" title="Day 1"></a>Day 1</h1><h2 id="神奇的幻方"><a href="#神奇的幻方" class="headerlink" title="神奇的幻方"></a>神奇的幻方</h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>幻方是一种很神奇的 $N \times N$ 矩阵：它由数字 $1,2,3, \cdots , N \times N$ 构成，且每行、每列<br>及两条对角线上的数字之和都相同。</p>
<a id="more"></a>
<p>当 $N$ 为奇数时，我们可以通过以下方法构建一个幻方：<br>首先将 $1$ 写在第一行的中间。之后,按如下方式从小到大依次填写每个数 $K(K = 2,3, \cdots , N \times N)$ ：</p>
<ol>
<li>若 $(K − 1)$ 在第一行但不在最后一列，则将 $K$ 填在最后一行，$(K − 1)$ 所在列<br>的右一列</li>
<li>若 $(K − 1)$ 在最后一列但不在第一行，则将 $K$ 填在第一列，$(K − 1)$ 所在行的上<br>一行</li>
<li>若 $(K − 1)$ 在第一行最后一列，则将 $K$ 填在 $(K − 1)$ 的正下方</li>
<li>若 $(K − 1)$ 既不在第一行,也不在最后一列，如果 $(K − 1)$ 的右上方还未填数，则将 $K$ 填在 $(K − 1)$ 的右上方，否则将 $K$ 填在 $(K − 1)$ 的正下方。</li>
</ol>
<p>现给定 $N$，请按上述方法构造 $N \times N$ 的幻方。</p>
<p>$ 1 \leq N \leq 39$ 且 $N$ 为奇数。</p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>记一下上一个数所在的位置 $(lastX, lastY)$ ，然后 $\Theta(n^{2})$ 扫一遍，模拟一下。</p>
<p>具体细节见代码。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Thursday, October 19, 2017 AM09:07:14 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">39</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line"><span class="keyword">int</span> a[MAX_N][MAX_N];</div><div class="line"><span class="keyword">bool</span> vis[MAX_N][MAX_N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line"></div><div class="line">    <span class="built_in">memset</span>(vis, <span class="literal">false</span>, <span class="keyword">sizeof</span> vis);</div><div class="line">    a[<span class="number">1</span>][(n + <span class="number">1</span>) / <span class="number">2</span>] = <span class="number">1</span>, vis[<span class="number">1</span>][(n + <span class="number">1</span>) / <span class="number">2</span>] = <span class="literal">true</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> lastX = <span class="number">1</span>, lastY = (n + <span class="number">1</span>) / <span class="number">2</span>;  <span class="comment">// row, column</span></div><div class="line"><span class="comment">//  printf("%d %d\n", lastX, lastY);</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n * n; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (lastX == <span class="number">1</span> &amp;&amp; lastY != n) &#123;</div><div class="line">            lastX = n, lastY = lastY + <span class="number">1</span>;</div><div class="line">            a[lastX][lastY] = i; vis[lastX][lastY] = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lastX != <span class="number">1</span> &amp;&amp; lastY == n) &#123;</div><div class="line">            lastX = lastX - <span class="number">1</span>, lastY = <span class="number">1</span>;</div><div class="line">            a[lastX][lastY] = i; vis[lastX][lastY] = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (lastX == <span class="number">1</span> &amp;&amp; lastY == n) &#123;</div><div class="line">            lastX = lastX + <span class="number">1</span>, lastY = lastY;</div><div class="line">            a[lastX][lastY] = i; vis[lastX][lastY] = <span class="literal">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line"><span class="comment">//          printf("%d\n", (int)vis[lastX - 1][lastY + 1]);</span></div><div class="line">            <span class="keyword">if</span> (vis[lastX - <span class="number">1</span>][lastY + <span class="number">1</span>] == <span class="literal">true</span>) &#123;</div><div class="line">                lastX = lastX + <span class="number">1</span>, lastY = lastY;</div><div class="line">                a[lastX][lastY] = i; vis[lastX][lastY] = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                lastX = lastX - <span class="number">1</span>, lastY = lastY + <span class="number">1</span>;</div><div class="line">                a[lastX][lastY] = i; vis[lastX][lastY] = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"><span class="comment">//      printf("%d %d\n", lastX, lastY);</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) <span class="built_in">printf</span>(<span class="string">"%d%c"</span>, a[i][j], j == n ? <span class="string">'\n'</span> : <span class="string">' '</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="信息传递"><a href="#信息传递" class="headerlink" title="信息传递"></a>信息传递</h2><h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>有 $n$ 个同学（编号为 $1$ 到 $n$ ）正在玩一个信息传递的游戏。在游戏里每人都有一个固定的信息传递对象，其中，编号为 $i$ 的同学的信息传递对象是编号为 $T_{i}$ 的同学。<br>游戏开始时，每人都只知道自己的生日。之后每一轮中，所有人会同时将自己当前所知的生日信息告诉各自的信息传递对象（注意：可能有人可以从若干人那里获取信息， 但是每人只会把信息告诉一个人，即自己的信息传递对象）。当有人从别人口中得知自 己的生日时，游戏结束。请问该游戏一共可以进行几轮？</p>
<p>$n \leq 2 \times 10^{5}$</p>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>模拟了很久发现是找一个有向图的最小环。</p>
<p>说实话，真没想到拓扑排序上面。由于没有智商，所以强行 Tarjan，时间复杂度为 $\Theta(n + m)$。</p>
<p>P.S. Blog 上面之前总结的 “ [关于图的连通性的三个Tarjan算法] “，有些地方有些小问题，找时间来改吧 !</p>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Thursday, October 19, 2017 AM09:37:57 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">200000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> n;</div><div class="line"><span class="keyword">int</span> pre[MAX_N], lowlink[MAX_N], sccno[MAX_N], scc_cnt, timeStamp;</div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; G[MAX_N];</div><div class="line"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; S;</div><div class="line"><span class="keyword">int</span> ans, size[MAX_N];</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> SCC &#123;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</div><div class="line">        pre[u] = lowlink[u] = ++timeStamp;</div><div class="line">        S.push(u);</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[u].size(); ++i) &#123;</div><div class="line">            <span class="keyword">int</span> v = G[u][i];</div><div class="line">            <span class="keyword">if</span> (!pre[v]) &#123;</div><div class="line">                dfs(v);</div><div class="line">                lowlink[u] = min(lowlink[u], lowlink[v]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!sccno[v]) lowlink[u] = min(lowlink[u], pre[v]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (lowlink[u] == pre[u]) &#123;</div><div class="line">            ++scc_cnt;</div><div class="line">            <span class="keyword">while</span> (<span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">int</span> x = S.top(); S.pop();</div><div class="line">                sccno[x] = scc_cnt;</div><div class="line">                <span class="keyword">if</span> (x == u) <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">findSCC</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="built_in">memset</span>(pre, <span class="number">0</span>, <span class="keyword">sizeof</span> pre);</div><div class="line">        <span class="built_in">memset</span>(lowlink, <span class="number">0</span>, <span class="keyword">sizeof</span> lowlink);</div><div class="line">        <span class="built_in">memset</span>(sccno, <span class="number">0</span>, <span class="keyword">sizeof</span> sccno);</div><div class="line">        timeStamp = scc_cnt = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">if</span> (!pre[i]) dfs(i);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> SCC;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; ++i) G[i].clear();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">        <span class="keyword">int</span> u = i, v = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">        --u; --v;</div><div class="line">        G[u].push_back(v);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    findSCC();</div><div class="line"></div><div class="line">    ans = INF;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) ++size[sccno[i]];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= scc_cnt; ++i) <span class="keyword">if</span> (<span class="number">1</span> &lt; size[i]) ans = min(ans, size[i]);</div><div class="line"></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="斗地主"><a href="#斗地主" class="headerlink" title="斗地主"></a>斗地主</h2><h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>牛牛最近迷上了一种叫斗地主的扑克游戏。斗地主是一种使用黑桃、红心、梅花、方片的 $A$ 到 $K$ 加上大小王的共 $54$ 张牌来进行的扑克牌游戏。在斗地主中，牌的大小关 系根据牌的数码表示如下： 3&lt;4&lt;5&lt;6&lt;7&lt;8&lt;9&lt;10&lt;J&lt;Q&lt;K&lt;A&lt;2&lt;小王&lt;大王，而花色并不对牌的大小产生影响。每一局游戏中，一副手牌由 nn 张牌组成。游戏者每次可以根据规定的牌型进行出牌，首先打光自己的手牌一方取得游戏的胜利。<br>现在，牛牛只想知道，对于自己的若干组手牌，分别最少需要多少次出牌可以将它们打光。请你帮他解决这个问题。<br>需要注意的是，本题中游戏者每次可以出手的牌型与一般的斗地主相似而略有不同。具体规则如下：</p>
<p><img src="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015.png" alt=""></p>
<p>$n \leq 23, testCase \leq 100$</p>
<h3 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h3><p>我练习的时候，还剩下 1.5h ，认真的思考了一下，好像并没有很清晰地思路，遂放弃刚正解。</p>
<p>于是我把特判的 30 分写了，然后还写挂了 $n = 4$ 的情况，我真是太菜啦qwq</p>
<p>思考正解。</p>
<p>一开始想到了搜索，但是并没有想到状压上面。那么这里就思考只用 dfs 怎么做吧！</p>
<p>首先要确定 dfs 的可行性，考虑现在有 23 张牌，那么在最坏的情况下，需要出 13 次牌。情况是这样的：1, 2, 3, 4, 6, 7, 8, 9, 11, 12, 13, 大王, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12。也就是说如果加上最优性剪枝，那么搜索的层数不会超过 13 层。</p>
<p>这里搜索的时候根据贪心的思想优先出三种顺子 : 单顺子，双顺子，三顺子 ; 然后出三带一，三带二 …… 总之将单牌留在最后出。出顺子的时候枚举一下顺子的首和尾，出三带几的时候先确定主体的牌再枚举带的牌。</p>
<p>具体细节看代码吧，由于思路比较暴力，这个算法过不了 <a href="http://uoj.ac/problem/151" target="_blank" rel="external">UOJ #151. 【NOIP2015】斗地主“加强”版</a> ，后面有时间再考虑怎么优化一下吧，正解应该还是 状压 + 搜索。</p>
<p>然后还要注意这里的四带二带的是不同的单牌或者是不同的一对牌。</p>
<p>时间复杂度 $\Theta$ (玄学)，这个时间复杂度我不会算有没有大佬能教一下，谢谢！</p>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><p>特判写的太丑了，就不放上来了qwq</p>
<p>$100 \%$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on 2017年10月31日 星期二 22时47分13秒</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">23</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> testCase, n;</div><div class="line"><span class="keyword">int</span> cnt[MAX_N];</div><div class="line"><span class="keyword">int</span> ans;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> depth)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (depth &gt;= ans) <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">int</span> res = depth;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> h1, t1, h2, t2, h3, t3;</div><div class="line">    h1 = t1 = <span class="number">3</span>, h2 = t2 = <span class="number">3</span>, h3 = t3 = <span class="number">3</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= <span class="number">15</span>; ++i) &#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (cnt[i]) &#123;</div><div class="line">            t1 = i;</div><div class="line">            <span class="keyword">if</span> (t1 - h1 &gt;= <span class="number">4</span> &amp;&amp; i &lt; <span class="number">15</span>) &#123;  <span class="comment">//  单顺子</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = h1; j &lt;= t1 - <span class="number">4</span>; ++j) &#123;  <span class="comment">//</span></div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt;= t1; ++k) --cnt[k];  <span class="comment">//</span></div><div class="line">                    dfs(depth + <span class="number">1</span>);</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt;= t1; ++k) ++cnt[k];  <span class="comment">//</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> h1 = i + <span class="number">1</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (cnt[i] &gt;= <span class="number">2</span>) &#123;</div><div class="line">            t2 = i;</div><div class="line">            <span class="keyword">if</span> (t2 - h2 &gt;= <span class="number">2</span> &amp;&amp; i &lt; <span class="number">15</span>) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = h2; j &lt;= t2 - <span class="number">2</span>; ++j) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt;= t2; ++k) cnt[k] -= <span class="number">2</span>;</div><div class="line">                    dfs(depth + <span class="number">1</span>);</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt;= t2; ++k) cnt[k] += <span class="number">2</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> h2 = i + <span class="number">1</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (cnt[i] &gt;= <span class="number">3</span>) &#123;</div><div class="line">            t3 = i;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (t3 - h3 &gt;= <span class="number">1</span> &amp;&amp; i &lt; <span class="number">15</span>) &#123;  <span class="comment">//  三顺子</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = h3; j &lt;= t3 - <span class="number">1</span>; ++j) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt;= t3; ++k) cnt[k] -= <span class="number">3</span>;</div><div class="line">                    dfs(depth + <span class="number">1</span>);</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = j; k &lt;= t3; ++k) cnt[k] += <span class="number">3</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            cnt[i] -= <span class="number">3</span>;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">3</span>; j &lt;= <span class="number">17</span>; ++j) <span class="keyword">if</span> (i != j &amp;&amp; cnt[j] &gt;= <span class="number">1</span>) &#123;  <span class="comment">//  三带一</span></div><div class="line">                --cnt[j];</div><div class="line">                dfs(depth + <span class="number">1</span>);</div><div class="line">                ++cnt[j];</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">3</span>; j &lt;= <span class="number">15</span>; ++j) <span class="keyword">if</span> (i != j &amp;&amp; cnt[j] &gt;= <span class="number">2</span>) &#123;  <span class="comment">// 三带二</span></div><div class="line">                cnt[j] -= <span class="number">2</span>;</div><div class="line">                dfs(depth + <span class="number">1</span>);</div><div class="line">                cnt[j] += <span class="number">2</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            cnt[i] += <span class="number">3</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> h3 = i + <span class="number">1</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (cnt[i] &gt;= <span class="number">4</span>) &#123;</div><div class="line">            cnt[i] -= <span class="number">4</span>;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">3</span>; j &lt;= <span class="number">17</span>; ++j) <span class="keyword">if</span> (i != j &amp;&amp; cnt[j] &gt;= <span class="number">1</span>) &#123;  <span class="comment">//  四带两张不同单牌</span></div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">3</span>; k &lt;= <span class="number">17</span>; ++k) <span class="keyword">if</span> (i != k &amp;&amp; cnt[k] &gt;= <span class="number">1</span>) &#123;</div><div class="line">                    --cnt[j]; --cnt[k];</div><div class="line">                    dfs(depth + <span class="number">1</span>);</div><div class="line">                    ++cnt[j]; ++cnt[k];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">3</span>; j &lt;= <span class="number">15</span>; ++j) <span class="keyword">if</span> (i != j &amp;&amp; cnt[j] &gt;= <span class="number">2</span>) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">3</span>; k &lt;= <span class="number">15</span>; ++k) <span class="keyword">if</span> (i != k &amp;&amp; cnt[k] &gt;= <span class="number">2</span>) &#123;  <span class="comment">//  四带两对不同的单牌</span></div><div class="line">                    cnt[j] -= <span class="number">2</span>; cnt[k] -= <span class="number">2</span>;</div><div class="line">                    dfs(depth + <span class="number">1</span>);</div><div class="line">                    cnt[j] += <span class="number">2</span>; cnt[k] += <span class="number">2</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            cnt[i] += <span class="number">4</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (cnt[<span class="number">16</span>] &gt;= <span class="number">1</span> &amp;&amp; cnt[<span class="number">17</span>] &gt;= <span class="number">1</span>) &#123;</div><div class="line">        --cnt[<span class="number">16</span>]; --cnt[<span class="number">17</span>];</div><div class="line">        dfs(depth + <span class="number">1</span>);</div><div class="line">        ++cnt[<span class="number">16</span>]; ++cnt[<span class="number">17</span>];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= <span class="number">17</span>; ++i) <span class="keyword">if</span> (cnt[i]) ++res;  <span class="comment">//  单牌出完</span></div><div class="line"></div><div class="line">    ans = min(ans, res);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    testCase = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;();  <span class="comment">//</span></div><div class="line"></div><div class="line">    <span class="keyword">while</span> (testCase--) &#123;</div><div class="line"></div><div class="line">        <span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="keyword">sizeof</span> cnt);</div><div class="line">        ans = <span class="number">13</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">            <span class="keyword">int</span> a = readIn&lt;<span class="keyword">int</span>&gt;(), b = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">            <span class="keyword">if</span> (a == <span class="number">0</span>) ++cnt[<span class="number">15</span> + b];  <span class="comment">//  king</span></div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (a == <span class="number">1</span> || a == <span class="number">2</span>) ++cnt[<span class="number">13</span> + a]; <span class="comment">// A and 2</span></div><div class="line">            <span class="keyword">else</span> ++cnt[a];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        dfs(<span class="number">0</span>);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h1><h2 id="跳石头"><a href="#跳石头" class="headerlink" title="跳石头"></a>跳石头</h2><h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>一年一度的＂跳石头＂比赛又要开始了！<br>这项比赛将在一条笔直的河道中进行，河道中分布着一些巨大岩石。组委会已经选择好了两块岩石作为比赛起点和终点。在起点和终点之间，有 $N$ 块岩石（不含起点和终点的岩石）。在比赛过程中，选手们将从起点出发，每一步跳向相邻的岩石，直至到达<br>终点。<br>为了提高比赛难度，组委会计划移走一些岩石，使得选手们在比赛过程中的最短跳跃距离尽可能长。由于预算限制，组委会至多从起点和终点之间移走 $M$ 块岩石（不能移走起点和终点的岩石）。</p>
<p>$D \leq M \leq N \leq 50000, 1 \leq L \leq 10^{9}$</p>
<h3 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h3><p>上一次做这道题目的时候还是去年的 10 月，当时太 Naive，怎么都想不明白为什么最大化最小值要二分qwq</p>
<p>好了，首先很明显这是一个最大化最小值问题，我们可以通过二分答案来做。</p>
<p>首先在读入起点和终点之间的石头距离起点的距离后，将起点和终点也加入进去（$d[0] = 0, d[N] = L$）。</p>
<p>令 $check(x)$ 为是否可以安排石头的位置使得相隔最近的两块石头之间的距离不小于 $x$。</p>
<p>那么我们需要求出最大的那个 $x$，我们用贪心的思想来判断，$pos$ 为上一个没有挪走的石块。</p>
<p>如果 $d[i] - d[pos] &lt;d$ ，那么我们需要将第 $i$ 块石头拿走。</p>
<p>否则，更新 $pos$ 即可。</p>
<p>时间复杂度 $\Theta(nlogn)$ 。</p>
<p>这里提一下二分中的小技巧，如果是最大化最小值我们通常在左闭右开的区间中二分：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (r - l &gt; <span class="number">1</span>) &#123; <span class="comment">// [l, r)</span></div><div class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (check(mid)) l = mid;</div><div class="line">    <span class="keyword">else</span> r = mid;</div><div class="line">&#125;</div><div class="line">ans = l;</div></pre></td></tr></table></figure>
<p>反之，如果我们要最小化最大值，则通常在左开右闭的区间中二分：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (r - l &gt; <span class="number">1</span>) &#123; <span class="comment">// (l, r]</span></div><div class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</div><div class="line">    <span class="keyword">if</span> (check(mid)) r = mid;</div><div class="line">    <span class="keyword">else</span> l = mid;</div><div class="line">&#125;</div><div class="line">ans = r;</div></pre></td></tr></table></figure>
<h3 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Friday, October 20, 2017 AM08:54:05 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">50000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> L, N, M;</div><div class="line"><span class="keyword">int</span> d[MAX_N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> cnt = M, pos = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; N + <span class="number">2</span>; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (d[i] - d[pos] &lt; x) --cnt;</div><div class="line">        <span class="keyword">else</span> pos = i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (cnt &gt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    L = readIn&lt;<span class="keyword">int</span>&gt;(), N = readIn&lt;<span class="keyword">int</span>&gt;(), M = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i) d[i] = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    d[N + <span class="number">1</span>] = L; d[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> l = <span class="number">1</span>, r = L + <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (r - l &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (check(mid)) l = mid;</div><div class="line">        <span class="keyword">else</span> r = mid;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, l);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="子串"><a href="#子串" class="headerlink" title="子串"></a>子串</h2><h3 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h3><p>有两个仅包含小写英文字母的字符串 $A$ 和 $B$。现在要从字符串 $A$ 中取出 $k$ 个互不重<br>叠的非空子串，然后把这 $k$ 个子串按照其在字符串 $A$ 中出现的顺序依次连接起来得到一个新的字符串，请问有多少种方案可以使得这个新串与字符串 $B$ 相等？</p>
<p>注意：子串取出的位置不同也认为是不同的方案 。</p>
<p>$1 \leq n \leq 1000, 1 \leq m \leq 200, 1 \leq k \leq m$</p>
<h3 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h3><p>是一道思维难度很好的动态规划题目，动态规划一直都是我的弱项，要加强呀qwq</p>
<p>一开始看这道题目的时候很容易就想到动态规划，然后开始肝转移方程。</p>
<p>令 $dp[i][j][k]$ 为 A 串匹配到第 $i$ 个位置，B 串匹配到第 $j$ 个位置，已经用了 $k$ 个子串。</p>
<p>那么我们有转移方程：</p>
<script type="math/tex; mode=display">dp[i][j][k] = dp[i - 1][j - 1][k - 1] + dp[i - 1][j - 1] [k] (strA[i] == strB[j])</script><p>好像很对的样子，恩，就是这样的。诶，好像有点点不对，如果我们不选择当前的字符怎么办，这个决策好像并没有被考虑进去。</p>
<p>上面的脑洞作废，重新开始，我们分情况来讨论。</p>
<p>我们令 $f[i][j][k]$ 为 A 串匹配到第 $i$ 个位置，B 串匹配到第 $j$ 个位置，已经用了 $k$ 个子串，一定会用 A 串的第 $i$ 个字符串方案数。</p>
<p>令 $g[i][j][k]$ 为 A 串匹配到第 $i$ 个位置，B 串匹配到第 $j$ 个位置，已经用了 $k$ 个子串的总方案数。</p>
<p>考虑转移方程先考虑 $f[i][j][k]$，当 $strA[i] = strB[j]$：</p>
<p>如果 A 串的第 $i$ 个字符自己成为一个子串那么 $f[i][j][k] = g[i - 1][j - 1][k - 1]$；<br>如果 A 串的第 $i$ 个字符和前面的字符串成为一串，那么 $f[i][j][k] = f[i - 1][j - 1][k]$。</p>
<p>这样一来有转移方程 <script type="math/tex">f[i][j][k] = g[i - 1][j - 1][k - 1] + f[i - 1][j - 1][k]​</script></p>
<p>反之，若 $strA[i] \neq strB[j]$，那么 <script type="math/tex">f[i][j][k] = 0</script></p>
<p>考虑 $g[i][j][k]$，<script type="math/tex">g[i][j][k] = g[i - 1][j][k] + f[i][j][k]</script></p>
<p>可以理解为，$g[i][j][k]$ 等于上一阶段不用 $strA[i - 1]$ 做为子串的方案数，加上使用 $strA[i - 1]$ 做为子串的方案数。</p>
<p>综上所述，我们有转移方程：</p>
<script type="math/tex; mode=display">
f[i][j][k] = \left\{\begin{matrix}
g[i - 1][j - 1][k - 1] + f[i - 1][j - 1][k] & \cdots &(strA[i - 1] = strB[j - 1])\\
0 & \cdots & (strA[i - 1] \neq strB[j - 1])
\end{matrix}\right.</script><script type="math/tex; mode=display">g[i][j][k] = g[i - 1][j][k] + f[i][j][k]</script><p>然后，如果我们转移方程开三维的话，会 MLE 所以考虑将第一维滚动一下。</p>
<h3 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h3><p>$70 \%$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Friday, October 20, 2017 AM09:28:35 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">100</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> n, m, K;</div><div class="line"><span class="keyword">char</span> strA[MAX_N], strB[MAX_M];</div><div class="line"><span class="keyword">int</span> f[MAX_N][MAX_M][MAX_M], g[MAX_N][MAX_N][MAX_M];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    g[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">        g[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</div><div class="line">            <span class="keyword">if</span> (strA[i] == strB[j]) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= min(j, K); ++k) &#123;</div><div class="line">                    f[i][j][k] = (g[i - <span class="number">1</span>][j - <span class="number">1</span>][k - <span class="number">1</span>] + f[i - <span class="number">1</span>][j - <span class="number">1</span>][k]) % MOD;</div><div class="line">                    g[i][j][k] = (g[i - <span class="number">1</span>][j][k] + f[i][j][k]) % MOD;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= min(j, K); ++k) g[i][j][k] = g[i - <span class="number">1</span>][j][k];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (g[n][m][K] % MOD + MOD) % MOD);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;(), m = readIn&lt;<span class="keyword">int</span>&gt;(), K = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, strA + <span class="number">1</span>); <span class="built_in">scanf</span>(<span class="string">"%s"</span>, strB + <span class="number">1</span>);</div><div class="line"></div><div class="line">    solve();</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>$100 \%$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Friday, October 20, 2017 PM02:48:04 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">1000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">200</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_K = <span class="number">200</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MOD = <span class="number">1e9</span> + <span class="number">7</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> n, m, K;</div><div class="line"><span class="keyword">char</span> strA[MAX_N], strB[MAX_N];</div><div class="line"><span class="keyword">int</span> f[MAX_N][MAX_K], g[MAX_N][MAX_K];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    g[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = m; j &gt;= <span class="number">1</span>; --j) &#123;</div><div class="line">            <span class="keyword">if</span> (strA[i] == strB[j]) &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = min(j, K); k &gt;= <span class="number">1</span>; --k) &#123;</div><div class="line">                    f[j][k] = (g[j - <span class="number">1</span>][k - <span class="number">1</span>] + f[j - <span class="number">1</span>][k]) % MOD;</div><div class="line">                    g[j][k] = (g[j][k] + f[j][k]) % MOD;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = min(j, K); k &gt;= <span class="number">1</span>; --k) f[j][k] = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, (g[m][K] % MOD + MOD) % MOD);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;(), m = readIn&lt;<span class="keyword">int</span>&gt;(), K = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, strA + <span class="number">1</span>); <span class="built_in">scanf</span>(<span class="string">"%s"</span>, strB + <span class="number">1</span>);</div><div class="line"></div><div class="line">    solve();</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="运输计划"><a href="#运输计划" class="headerlink" title="运输计划"></a>运输计划</h2><h3 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h3><p>公元 2044 年，人类进入了宇宙纪元。<br>​L 国有 $n$ 个星球，还有  $n - 1$ 条双向航道，每条航道建立在两个星球之间，这  $n - 1$ 条航道连通了 L 国的所有星球。<br>小 P 掌管一家物流公司， 该公司有很多个运输计划，每个运输计划形如：有一艘物流飞船需要从 $u_{i}$ 号星球沿最快的宇航路径飞行到 $v_{i}$ 号星球去。显然，飞船驶过一条航道是需要时间的，对于航道 $j$，任意飞船驶过它所花费的时间为 $t_{j}$，并且任意两艘飞船之间不会产生任何干扰。<br>为了鼓励科技创新，L 国国王同意小 P 的物流公司参与 L 国的航道建设，即允许小 P 把某一条航道改造成虫洞，飞船驶过虫洞不消耗时间。<br>在虫洞的建设完成前小 P 的物流公司就预接了 $m$ 个运输计划。在虫洞建设完成后，这 $m$ 个运输计划会同时开始，所有飞船一起出发。当这 $m$ 个运输计划都完成时，小 P 的物流公司的阶段性工作就完成了。<br>如果小 P 可以自由选择将哪一条航道改造成虫洞，试求出小 P 的物流公司完成阶段性工作所需要的最短时间是多少？</p>
<p>$n , m \leq 300000$</p>
<h3 id="分析-5"><a href="#分析-5" class="headerlink" title="分析"></a>分析</h3><p>做这道题目的时候，我大概是一条没有梦想的咸鱼 qwq</p>
<p>部分分的话有 $\Theta(n^{2})$ 的 50 分和 $m = 1$ 的 10 分，也就是暴力有 60 分，总体来说暴力分还是美滋滋的 qwq</p>
<p>$\Theta(n^{2})$ 的就是枚举那一条边改为虫洞，至于 $m = 1$ 的部分就 $\Theta(n)$ 扫一遍即可。</p>
<p>考虑正解。</p>
<p>因为 “这 $m$ 个运输计划会同时开始，所有飞船一起出发” ，那么我们所求的其实就是最小化耗时最长的飞船的飞行时间，这是一个最小化最大值的问题，可以用二分来解决，那么每次二分一个时间 $mid$ 然后 <code>check</code> 一下。</p>
<p>还有一个套路就是在计算在 $u_{i}$ 和 $v_{i}$ 两点之间的耗费时间（距离）的时候，可以用 <code>倍增</code> 在 $\Theta(logn)$ 的时间内计算。</p>
<p>现在要考虑一个问题如何在树上比较高效的 <code>check</code> 将一条边的时间变为 $0$ 后，$m$ 条路径的最大时间最小小于 $mid$ 。</p>
<p>我们先倍增预处理 $fa[i][j]$ 即 $i$ 的第 $2^{j}$ 级祖先，以及 $dis[i][j]$ 为从 $i$ 出发向上条 $2^{j}$ 级的路径长度。那么如果两点$u, v$ 之间的路径长度小于等于 $mid$ 则忽略，否则考虑在 $u, v$ 之间的路径中选择一条边，将这条边的权值变为 $0$ 。</p>
<p>那么问题就变为：<code>check</code> 求出两点之间距离大于 $mid$ 的路径的交集中的边权最大的边，看去掉这条边之后，是否满足 $m$ 条路径的最大时间最小小于 $mid$ 。</p>
<p>考虑求路径交集中的最长路径，我们有两种方法：</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>路径 <code>(a, c)</code> ，<code>(b, d)</code> 之间的交集必定在 <code>LCA(a, b)</code>，<code>LCA(a, c)</code>，<code>LCA(a, d)</code>，<code>LCA(b, c)</code>，<code>LCA(b, d)</code>，<code>LCA(c, d)</code> 这六个点之间。暴力模拟一下求交集的过程，由于思想比较暴力，UOJ 上的 hack 数据会 TLE，但是对于官方数据还是可行的。</p>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>我觉的方法二更妙一些 qwq</p>
<p>记 $total$ 为两点之间距离大于 $mid$ 的路径数量，而 $cnt_{i}$ 为这些路径中边 $e_{i}$ 被经过的次数。那么 $cnt_{i} = total$ 意味着边 $e_{i}$ 为这些路径的交集中的一条边。</p>
<p>每一轮二分都重新计算一次的时间复杂度为 $\Theta(n^{2})$ ，这<del>显然</del>是不现实的。我们需要一个时间复杂度更优的方法，来维护每一条边被经过的次数。</p>
<p>这里就要用到<strong>树上前缀和</strong>了。</p>
<p>那么，如果要将一条边权变为 $0$ 怎么能较为高效的做到呢？这个和 <a href="https://www.luogu.org/problemnew/show/1083" target="_blank" rel="external">NOIP 2012 借教室</a> 一题中，我们用前缀和差分的思想差不多。在线性序列上，如果要将 $[l, r]$ 的区间 <code>+k</code> ，需要进行如下的操作：</p>
<p><img src="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015%E2%80%982.png" alt=""></p>
<p>那么令 $sum_{i}$ 为前 $i$ 位的前缀和，那么 $sum_{i}$ 可以表示为 $sum_{i} = \sum_{j = 1}^{i}a_{i}$ ，如图所示：</p>
<p><img src="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015%27s.png" alt=""></p>
<p>那么如果在树上做前缀和呢？令 $sum[i]$ 为结点 $i$ 到 $i$ 的父亲这条边被经过的次数，$dis_{i}$ 为顶点 $i$ 到其父亲边上的权值。</p>
<p><img src="http://oqeu5dc5m.bkt.clouddn.com/NOIP%202015%275.png" alt=""></p>
<p>树上两点 $u, v$ 之间的距离为 $dis[u] + dis[v] - dis[lca(u, v)]$ ，更新 $u, v$ 之间路径被经过的次数则进行操作 <code>++sum[u]</code> , <code>++sum[v]</code>  , <code>sum[lca(u, v)] - 2</code> ，树上前缀和则为 $sum_{i} = \sum_{k \in son(i)}sum_{k}$ 。</p>
<p>我们可以利用树的 dfs 序，在 $\Theta(n)$ 的时间复杂度内计算出 $sum_{i}$ 的前缀和。</p>
<p>总时间复杂度  $\Theta(nlogn + mlogn + 2logn(m + n))$ 。</p>
<h3 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h3><p>$60 \%$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Wednesday, November 01, 2017 AM09:10:39 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">100000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_M = <span class="number">3000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_LOG_N = <span class="number">15</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> to; ll w;</div><div class="line">    Edge(<span class="keyword">int</span> to, ll w) : to(to), w(w) &#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">vector</span>&lt;Edge&gt; G[MAX_N &lt;&lt; <span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> s[MAX_N], t[MAX_N];  <span class="comment">//  start , end;</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, ll cost)</span> </span>&#123;</div><div class="line">    G[from].push_back(Edge(to, cost));</div><div class="line">    G[to].push_back(Edge(from, cost));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> depth[MAX_N], fa[MAX_N];</div><div class="line">ll val[MAX_N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</div><div class="line">    depth[u] = depth[f] + <span class="number">1</span>; fa[u] = f;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[u].size(); ++i) &#123;</div><div class="line">        Edge &amp;e = G[u][i];</div><div class="line">        <span class="keyword">if</span> (e.to == f) <span class="keyword">continue</span>;</div><div class="line">        val[e.to] = e.w;</div><div class="line">        dfs(e.to, u);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve1</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    ll res = <span class="number">0</span>, mx = <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (depth[u] &lt; depth[v]) swap(u, v);</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (depth[u] &gt; depth[v]) &#123;</div><div class="line">        res += val[u];</div><div class="line">        mx = max(mx, val[u]);</div><div class="line">        u = fa[u];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (u != v) &#123;</div><div class="line">        res += val[u]; res += val[v];</div><div class="line">        mx = max(mx, max(val[u], val[v]));</div><div class="line">        u = fa[u], v = fa[v];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res - mx);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> road[MAX_M][MAX_M];</div><div class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    ll res = <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (depth[u] &lt; depth[v]) swap(u, v);</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (depth[u] &gt; depth[v]) &#123;</div><div class="line">        res += val[u];</div><div class="line">        road[u][i] = <span class="number">1</span>;</div><div class="line">        u = fa[u];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (u != v) &#123;</div><div class="line">        res += val[u]; res += val[v];</div><div class="line">        road[u][i] = <span class="number">1</span>; road[v][i] = <span class="number">1</span>;</div><div class="line">        u = fa[u]; v = fa[v];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ll ans[MAX_N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve2</span><span class="params">()</span> </span>&#123;</div><div class="line">    ll res = <span class="number">-1</span>;</div><div class="line">    <span class="built_in">memset</span>(road, <span class="number">0</span>, <span class="keyword">sizeof</span> road);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        ans[i] = calculate(i, s[i], t[i]);</div><div class="line">        res = max(res, ans[i]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;   <span class="comment">//</span></div><div class="line">        ll temp = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</div><div class="line">            temp = max(temp, (ll)ans[j] - val[i] * road[i][j]);  <span class="comment">//</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (res == <span class="number">-1</span> || res &gt; temp) res = temp;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;(), m = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">1</span>; ++i) &#123;</div><div class="line">        <span class="keyword">int</span> u = readIn&lt;<span class="keyword">int</span>&gt;(), v = readIn&lt;<span class="keyword">int</span>&gt;(), w = readIn&lt;ll&gt;();</div><div class="line">        addEdge(u, v, w);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) s[i] = readIn&lt;<span class="keyword">int</span>&gt;(), t[i] = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line"></div><div class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (m == <span class="number">1</span>) solve1(s[<span class="number">1</span>], t[<span class="number">1</span>]);</div><div class="line">    <span class="keyword">else</span> solve2();</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>方法一：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on Wednesday, November 01, 2017 PM02:10:47 CST</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">300000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_LOG_N = <span class="number">15</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> to, next, w;</div><div class="line">&#125;edge[MAX_N &lt;&lt; <span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> head[MAX_N], cnt = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> s[MAX_N], t[MAX_N];</div><div class="line"><span class="keyword">int</span> depth[MAX_N], fa[MAX_N][MAX_LOG_N], dis[MAX_N][MAX_LOG_N], maxVal[MAX_N][MAX_LOG_N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">int</span> w)</span> </span>&#123;</div><div class="line">    edge[++cnt].to = to; edge[cnt].w = w; edge[cnt].next = head[from]; head[from] = cnt;</div><div class="line">    edge[++cnt].to = from; edge[cnt].w = w; edge[cnt].next = head[to]; head[to] = cnt;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</div><div class="line">    depth[u] = f == <span class="number">0</span> ? <span class="number">0</span> : depth[f] + <span class="number">1</span>; fa[u][<span class="number">0</span>] = f;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i != <span class="number">-1</span>; i = edge[i].next) &#123;</div><div class="line">        <span class="keyword">int</span> v = edge[i].to;</div><div class="line">        <span class="keyword">if</span> (v == f) <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">        dis[v][<span class="number">0</span>] = edge[i].w;</div><div class="line">        maxVal[v][<span class="number">0</span>] = edge[i].w;</div><div class="line">        dfs(v, u);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> allCost, maxCost, lca;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    allCost = <span class="number">0</span>, maxCost = <span class="number">0</span>, lca = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (depth[u] &lt; depth[v]) swap(u, v);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAX_LOG_N - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</div><div class="line">        <span class="keyword">if</span> (depth[u] - (<span class="number">1</span> &lt;&lt; i) &gt;= depth[v]) &#123;</div><div class="line">            allCost += dis[u][i];</div><div class="line">            maxCost = max(maxCost, maxVal[u][i]);</div><div class="line"></div><div class="line"><span class="comment">//          printf("%d %d %d %d %d\n", u, i, fa[u][i], dis[u][i], maxVal[u][i]);</span></div><div class="line">            u = fa[u][i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (u == v) &#123;</div><div class="line">        lca = u; <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAX_LOG_N - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</div><div class="line">        <span class="keyword">if</span> (depth[u] - (<span class="number">1</span> &lt;&lt; i) &gt;= <span class="number">0</span> &amp;&amp; fa[u][i] != fa[v][i]) &#123;</div><div class="line">            allCost += dis[u][i]; allCost += dis[v][i];</div><div class="line">            maxCost = max(maxCost, max(maxVal[u][i], maxVal[v][i]));</div><div class="line"></div><div class="line"><span class="comment">//          printf("%d %d %d %d %d\n", u, i, fa[u][i], dis[u][i], maxVal[u][i]);</span></div><div class="line"><span class="comment">//          printf("%d %d %d %d %d\n", v, i, fa[v][i], dis[v][i], maxVal[v][i]);</span></div><div class="line"></div><div class="line">            u = fa[u][i]; v = fa[v][i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    allCost = allCost + dis[u][<span class="number">0</span>] + dis[v][<span class="number">0</span>];</div><div class="line">    maxCost = max(maxCost, max(maxVal[u][<span class="number">0</span>], maxVal[v][<span class="number">0</span>]));</div><div class="line">    lca = fa[u][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> sum[MAX_N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; MAX_LOG_N; ++j) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">            fa[i][j] = fa[fa[i][j - <span class="number">1</span>]][j- <span class="number">1</span>];</div><div class="line">            dis[i][j] = dis[i][j - <span class="number">1</span>] + dis[fa[i][j - <span class="number">1</span>]][j - <span class="number">1</span>];</div><div class="line">            maxVal[i][j] = max(maxVal[i][j - <span class="number">1</span>], maxVal[fa[i][j - <span class="number">1</span>]][j - <span class="number">1</span>]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">    for (int j = 0; j &lt; MAX_LOG_N; ++j) &#123;</span></div><div class="line"><span class="comment">        for (int i = 1; i &lt;= n; ++i) &#123;</span></div><div class="line"><span class="comment">            printf("%d %d %d %d %d\n", i, j, fa[i][j], dis[i][j], maxVal[i][j]);</span></div><div class="line"><span class="comment">        &#125;</span></div><div class="line"><span class="comment">        printf("\n");</span></div><div class="line"><span class="comment">    &#125;</span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        query(s[i], t[i]);</div><div class="line">        sum[i] = allCost;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//  for (int i = 1; i &lt;= m; ++i) printf("%d %d\n", i, sum[i]);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    query(u, v);</div><div class="line">    <span class="keyword">return</span> lca;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">length</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    query(u, v);</div><div class="line">    <span class="keyword">return</span> allCost;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">maxLength</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</div><div class="line">    query(u, v);</div><div class="line">    <span class="keyword">return</span> maxCost;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">inPath</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c, <span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len1 = length(a, c), len2 = length(a, d), len3 = length(c, d);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (len2 &lt; len1) &#123;</div><div class="line">        swap(c, d); len1 = len2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> len4 = length(b, d);</div><div class="line">    <span class="keyword">return</span> (len1 + len3 + len4 == length(a, b)) ? len3 : <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getIntersection</span><span class="params">(<span class="keyword">int</span> &amp;a, <span class="keyword">int</span> &amp;b, <span class="keyword">int</span> c, <span class="keyword">int</span> d)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> u = <span class="number">-1</span>, v = <span class="number">-1</span>, nowLength = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;  <span class="comment">//  为什么把 vector 放在外面会超时？ 求教qwq</span></div><div class="line">    vec.push_back(LCA(a, b));</div><div class="line">    vec.push_back(LCA(a, c));</div><div class="line">    vec.push_back(LCA(a, d));</div><div class="line">    vec.push_back(LCA(b, c));</div><div class="line">    vec.push_back(LCA(b, d));</div><div class="line">    vec.push_back(LCA(c, d));</div><div class="line">    vec.erase(unique(vec.begin(), vec.end()), vec.end());</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)vec.size(); ++i) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; (<span class="keyword">int</span>)vec.size(); ++j) &#123;</div><div class="line">            <span class="keyword">int</span> len = inPath(a, b, vec[i], vec[j]);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (len &gt; nowLength &amp;&amp; inPath(c, d, vec[i], vec[j])) &#123;</div><div class="line">                u = vec[i]; v = vec[j]; nowLength = len;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    a = u, b = v;</div><div class="line">    <span class="keyword">return</span> nowLength;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> lim)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> a = <span class="number">-1</span>, b = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (sum[i] &lt;= lim) <span class="keyword">continue</span>;</div><div class="line">        <span class="keyword">if</span> (a == <span class="number">-1</span> &amp;&amp; b == <span class="number">-1</span>) a = s[i], b = t[i];</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (getIntersection(a, b, s[i], t[i]) &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> decrease = maxLength(a, b);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (sum[i] - decrease &gt; lim) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> l = <span class="number">-1</span>, r = <span class="number">300000000</span>;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (r - l &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</div><div class="line"><span class="comment">//      printf("%d %d %d\n", l, r, mid);</span></div><div class="line">        <span class="keyword">if</span> (check(mid)) r = mid;</div><div class="line">        <span class="keyword">else</span> l = mid;  <span class="comment">//</span></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, r);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;(), m = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    <span class="built_in">memset</span>(head, <span class="number">-1</span>, <span class="keyword">sizeof</span> head);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">1</span>; ++i) &#123;</div><div class="line">        <span class="keyword">int</span> u = readIn&lt;<span class="keyword">int</span>&gt;(), v = readIn&lt;<span class="keyword">int</span>&gt;(), w = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">        addEdge(u, v, w);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) s[i] = readIn&lt;<span class="keyword">int</span>&gt;(), t[i] = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line"></div><div class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    prepare();</div><div class="line">    solve();</div><div class="line"></div><div class="line"><span class="comment">//  fprintf(stderr, "Time used : %.3f\n", (double)clock() / CLOCKS_PER_SEC);</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>好了，在 Lantern 的帮助下明白了为什么吧 vector 放在外面会 TLE。就是如果吧 vector 放在外面每一次求 <code>(a, c)</code> , <code>(b, d)</code> 线段的交的时候把他们和之前的 LCA 都累加了，求完线段交之后又没有清空 vector （因为 vector 此时是作为全局变量而言的），这样每次去重的效率就很低，自然而然就 TLE 了</p>
<p>$100 \%$</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  Created by ZJYelizaveta on 2017年11月02日 星期四 17时20分28秒</span></div><div class="line"><span class="comment">//  Copyright (c) 2017年 ZJYelizaveta. All rights reserved.</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ull;</div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="function">T <span class="title">readIn</span><span class="params">()</span> </span>&#123;</div><div class="line">    T x(0), f(1);</div><div class="line">    <span class="keyword">char</span> ch = getchar();</div><div class="line">    <span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>) &#123;<span class="keyword">if</span> (ch == <span class="string">'-'</span>) f = <span class="number">-1</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>) &#123;x = x * <span class="number">10</span> + ch - <span class="string">'0'</span>; ch = getchar();&#125;</div><div class="line">    <span class="keyword">return</span> x * f;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_N = <span class="number">300000</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_LOG_N = <span class="number">17</span> + <span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</div><div class="line"><span class="keyword">int</span> n, m;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> to, w;</div><div class="line">    Edge (<span class="keyword">int</span> to, <span class="keyword">int</span> w) : to(to), w(w)&#123;&#125;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">vector</span>&lt;Edge&gt; G[MAX_N &lt;&lt; <span class="number">1</span>];</div><div class="line"><span class="keyword">int</span> s[MAX_N], t[MAX_N];</div><div class="line"><span class="keyword">int</span> depth[MAX_N], dis[MAX_N], val[MAX_N], fa[MAX_N][MAX_LOG_N];</div><div class="line"><span class="keyword">int</span> lca[MAX_N], cost[MAX_N];</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addEdge</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">int</span> cost)</span> </span>&#123;</div><div class="line">    G[from].push_back(Edge(to, cost));</div><div class="line">    G[to].push_back(Edge(from, cost));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> pos[MAX_N], timeStamp = <span class="number">0</span>;</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</div><div class="line">    pos[++timeStamp] = u;</div><div class="line">    depth[u] = f == <span class="number">0</span> ? <span class="number">0</span> : depth[f] + <span class="number">1</span>; fa[u][<span class="number">0</span>] = f;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[u].size(); ++i) &#123;</div><div class="line">        Edge &amp;e = G[u][i];</div><div class="line">        <span class="keyword">if</span> (e.to == f) <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">        val[e.to] = e.w;</div><div class="line">        dis[e.to] = dis[u] + e.w;</div><div class="line">        dfs(e.to, u);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (depth[a] &lt; depth[b]) swap(a, b);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAX_LOG_N - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</div><div class="line">        <span class="keyword">if</span> (depth[a] - (<span class="number">1</span> &lt;&lt; i) &gt;= depth[b]) &#123;</div><div class="line">            a = fa[a][i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (a == b) <span class="keyword">return</span> a;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = MAX_LOG_N - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</div><div class="line">        <span class="keyword">if</span> (depth[a] - (<span class="number">1</span> &lt;&lt; i) &gt;= <span class="number">0</span> &amp;&amp; fa[a][i] != fa[b][i]) &#123;</div><div class="line">            a = fa[a][i], b = fa[b][i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> fa[a][<span class="number">0</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="comment">//  for (int i = 1; i &lt;= n; ++i) printf("%d ", pos[i]); printf("\n");</span></div><div class="line"><span class="comment">//  for (int i = 1; i &lt;= n; ++i) printf("%d fa = %d depth = %d val = %d dis = %d\n", i, fa[i][0], depth[i], val[i], dis[i]);</span></div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; MAX_LOG_N; ++j) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">            fa[i][j] = fa[fa[i][j - <span class="number">1</span>]][j - <span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        lca[i] = LCA(s[i], t[i]);</div><div class="line">        cost[i] = dis[s[i]] + dis[t[i]] - <span class="number">2</span> * dis[lca[i]];</div><div class="line">    &#125;</div><div class="line"><span class="comment">//  for (int i = 1; i &lt;= m; ++i) printf("%d %d %d\n", i, lca[i], cost[i]);</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> sum[MAX_N];</div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> lim)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> cnt = <span class="number">0</span>;</div><div class="line">    <span class="built_in">memset</span>(sum, <span class="number">0</span>, <span class="keyword">sizeof</span> sum);</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (cost[i] &lt;= lim) <span class="keyword">continue</span>;</div><div class="line">        ++cnt;</div><div class="line">        ++sum[s[i]], ++sum[t[i]], sum[lca[i]] -= <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (cnt == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; --i) &#123;</div><div class="line">        sum[fa[pos[i]][<span class="number">0</span>]] += sum[pos[i]];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> dec = <span class="number">0</span>;  <span class="comment">//  max decrease</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (sum[i] == cnt) dec = max(dec, val[i]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</div><div class="line">        <span class="keyword">if</span> (cost[i] - dec &gt; lim) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> l = <span class="number">-1</span>, r = INF;</div><div class="line">    <span class="keyword">while</span> (r - l &gt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (check(mid)) r = mid;</div><div class="line">        <span class="keyword">else</span> l = mid;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, r);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line"><span class="comment">//  freopen("test.in", "r", stdin);</span></div><div class="line"></div><div class="line">    n = readIn&lt;<span class="keyword">int</span>&gt;(), m = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n - <span class="number">1</span>; ++i) &#123;</div><div class="line">        <span class="keyword">int</span> u = readIn&lt;<span class="keyword">int</span>&gt;(), v = readIn&lt;<span class="keyword">int</span>&gt;(), w = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line">        addEdge(u, v, w);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) s[i] = readIn&lt;<span class="keyword">int</span>&gt;(), t[i] = readIn&lt;<span class="keyword">int</span>&gt;();</div><div class="line"></div><div class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>);</div><div class="line">    prepare();</div><div class="line">    solve();</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>写完这个树上前缀和这个方法后，美滋滋的去 UOJ 上交，以为可以过 Extra test，结果还是 97 分qwq，不是 TLE 但是 WA 了。内心比较崩溃，很仔细的看了好几遍程序，没问题呀，绝望之下改了一下 <code>MAX_LOG_N</code> 的大小，再交，然后 A 了qwq。可是 $ln(3 \times 10^{5}) = 13$ 不是吗，$ln$ 的底数可是自然数 $e$ 呀，[关爱智障的眼神].jpg</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2017/11/02/NOIP-2015-整理/" data-id="cj9s407ut001k3guj87jw7qh9" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/11/09/NOIP-2016-整理/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    NOIP 2016 整理
                
            </div>
        </a>
    
    
        <a href="/2017/10/31/NOIP-2012-整理/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">NOIP 2012 整理</div>
        </a>
    
</nav>


    
</article>


    
    
        <section id="comments">
	<div id="commentContainer"></div>
</section>
    

</section>
            
                
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 ZJYelizaveta<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
	<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
	<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
	<script>
		var gitment = new Gitment({
			owner: 'ZJYelizaveta',
			repo: 'ZJYelizaveta.github.io',
			oauth: {
				client_id: 'c0a1c9fd8a0a898e24d1',
				client_secret: 'cac4eeb49169f56188b5a93e1824e9e68f396193',
			},
		})
		gitment.render('commentContainer')
	</script>
	



    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>